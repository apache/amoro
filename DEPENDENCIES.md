# Amoro Project – Required Dependencies

This document lists what you need to build and run Amoro, and how to download Maven dependencies.

## System requirements

| Requirement | Version / notes |
|-------------|------------------|
| **Java** | **Java 11** (required). The project is built with `java.source.version` and `java.target.version` 11. Java 17+ may cause Spotless or Scala compiler issues; use Java 11 for a full build. |
| **Maven** | 3.6+ (or use the wrapper: `./mvnw`) |
| **Scala** | 2.12.15 (used by the build; no separate install needed) |

### Optional (for specific features)

| Requirement | Use |
|-------------|-----|
| **Node.js & pnpm** | Building the `amoro-web` frontend (Vue.js) |
| **Docker & Kind** | Running the full stack via `make setup-amoro` |
| **Hadoop / Hive** | Optional runtime; some modules use Hadoop 3.4.0 / Hive 3.1.3 as dependency versions |

---

## How dependencies are managed

- **Java/Maven**: All Java and Scala dependencies are declared in the root `pom.xml` and in each module’s `pom.xml`. Maven resolves them from Maven Central (and any configured repositories).
- **No separate “install dependency” step**: Running Maven (e.g. `./mvnw install` or `./mvnw dependency:resolve`) is what downloads JARs into your local repository (`~/.m2/repository`).

---

## How to download all Maven dependencies

### Option 1: Full build (recommended if you have Java 11)

From the project root:

```bash
./mvnw install -DskipTests
```

This builds all modules and downloads every dependency. If license/format checks get in the way during development, you can skip them:

```bash
./mvnw install -DskipTests -Drat.skip=true -Dspotless.check.skip=true -Dcheckstyle.skip=true
```

**Note:** With **Java 21**, Spotless (Google Java Format) and the Scala 2.12 compiler may fail. For a clean full build, use **Java 11**.

### Option 2: Only resolve and download (no compile)

To only resolve and download dependencies without compiling (useful for populating `~/.m2` or CI cache):

1. Install the Amoro modules that are not in a public repo (so that SNAPSHOTs exist locally):

   ```bash
   ./mvnw install -N -DskipTests -Drat.skip=true -Dspotless.check.skip=true -Dcheckstyle.skip=true
   ./mvnw install -pl amoro-common,amoro-web -am -DskipTests -Drat.skip=true -Dspotless.check.skip=true -Dcheckstyle.skip=true
   ```

2. Then resolve (and download) dependencies for the whole reactor:

   ```bash
   ./mvnw dependency:resolve dependency:resolve-plugins -Drat.skip=true -Dspotless.check.skip=true -Dcheckstyle.skip=true
   ```

### Option 3: Make target

From the project root:

```bash
make deps-download
```

This runs Maven with the same skips as above to try to resolve and download dependencies. A full build still requires Java 11 if you hit Spotless/Scala errors.

---

## Key dependency versions (from root `pom.xml`)

For reference only; you do not need to install these by hand – Maven pulls the right versions.

| Component | Version |
|-----------|---------|
| Apache Iceberg | 1.6.1 |
| Apache Spark | 3.5.7 |
| Apache Hadoop | 3.4.0 |
| Apache Hive | 3.1.3 |
| Apache Paimon | 1.2.0 |
| Apache Hudi | 0.14.1 |
| Scala | 2.12.15 |
| Flink | 1.20.3 |
| Netty | 4.1.128.Final |
| Javalin | 4.6.8 |
| MyBatis | 3.5.15 |
| PostgreSQL JDBC | 42.7.2 |
| Derby | 10.14.2.0 |
| AWS SDK (BOM) | 2.24.12 |
| Kyuubi (Hive JDBC shaded) | 1.10.2 |
| RocksDB | 7.10.2 |
| Curator | 5.7.0 |
| Log4j | 2.20.0 |
| SLF4J | 1.7.30 |

---

## Dependency list files (for CI / auditing)

The project keeps a list of runtime dependencies for the dist classpath under:

- `dev/deps/dependencies-hadoop-2-spark-3.5`
- `dev/deps/dependencies-hadoop-3-spark-3.5`

These are generated by:

```bash
./dev/dependencies.sh
```

Use `./dev/dependencies.sh --replace` to refresh the lists after changing dependencies.

---

## Summary

- **Required:** Java 11, Maven 3.6+ (or `./mvnw`).
- **Download deps:** Run `./mvnw install -DskipTests` (with optional `-Drat.skip=true -Dspotless.check.skip=true -Dcheckstyle.skip=true`), or use `make deps-download` after adding the target below.
- **If you only have Java 21:** Use the same Maven commands; if Spotless or Scala fail, install Java 11 and set `JAVA_HOME` to it for the build.
