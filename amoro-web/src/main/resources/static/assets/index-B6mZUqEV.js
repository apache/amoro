
/*
  * Licensed to the Apache Software Foundation (ASF) under one
  * or more contributor license agreements.  See the NOTICE file
  * distributed with this work for additional information
  * regarding copyright ownership.  The ASF licenses this file
  * to you under the Apache License, Version 2.0 (the
  * "License"); you may not use this file except in compliance
  * with the License.  You may obtain a copy of the License at
  *
  *     http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */

import{d as it,U as mt,a8 as pt,c as dt,w as Ct,r as Y,o as lt,ae as et,W as bt,X as c,a0 as L,a3 as d,a6 as f,k as v,u as H,a2 as U,V as q,f as B,F as J,a9 as Ut,Y as i,G as K,m as Tt,A as St,aa as st,I as zt,j as Kt,af as kt,ab as jt,ac as qt,a7 as Gt,y as Ht,ag as Vt}from"./vue-KZ6HWXOH.js";import{c as Wt,d as Yt,e as Zt,f as Jt,h as Qt,i as Xt,j as te,k as ee,l as ae,m as ne,n as oe,o as se}from"./table.service-CoshcICY.js";import{b as at,_ as ft,a as ie,i as le,f as Et,c as yt,u as re}from"./index-C3lMfZSI.js";import{p as ht,f as ce,q as $t,d as ue,e as de,B as vt,r as wt,s as xt,M as At,a as pe,k as fe,b as me,D as he,I as ve,t as ge,u as Nt,v as Mt,w as _e,S as ye,x as Pt,y as Ft,Q as be,z as Ce}from"./antd-CPSoav-4.js";import{u as ut}from"./usePagination-flyrWnsD.js";import{c as Ie,g as Te}from"./dayjs-DZyl58SH.js";import{b as nt,o as ct}from"./common.type-BplHNJCB.js";import{A as Se,C as ke,a as $e,b as we,S as xe,M as Ee,P as Oe,c as De,d as Le,e as ze,f as Ae,g as Ne,h as Me,i as Pe,j as Fe,k as Re,l as Be,m as Ue,n as Ke,o as je,p as qe,q as Ge,r as He,s as Ve,t as We,u as Ye,v as Ze,w as Je,x as Qe,y as Xe,z as ta,B as Ot,D as ea,E as aa,F as na,G as oa,H as sa,I as ia,J as la,K as ra,L as ca,N as ua,O as da,Q as pa,R as fa,T as ma,U as ha,V as va,W as ga,X as _a,Y as Rt,Z as ya,_ as ba,$ as Ca,a0 as Ia,a1 as Ta,a2 as Sa,a3 as ka,a4 as $a,a5 as wa,a6 as xa,a7 as Ea,a8 as Oa,a9 as Da,aa as La,ab as za,ac as Aa}from"./echarts-lNMs2io7.js";import"./pinia-BCc-Ghqu.js";import"./monaco-DM8nFf3H.js";import"./sql-BwF-LpWF.js";import"./axios-B4uVmeYG.js";const Na={class:"table-detail g-flex"},Ma={class:"left-content"},Pa={key:0,class:"table-attrs"},Fa={class:"attr-title"},Ra={key:1,class:"table-attrs"},Ba={class:"attr-title"},Ua={class:"table-attrs"},Ka={class:"attr-title"},ja={class:"right-content"},qa={key:0,class:"table-attrs"},Ga={class:"attr-title"},Ha={class:"table-attrs"},Va={class:"attr-title"},Wa={class:"table-attrs"},Ya={class:"attr-title"},Za=it({__name:"Details",emits:["setBaseDetailInfo"],setup(C,{expose:y,emit:g}){const T=g,{t:l}=mt(),n=pt(),r=dt(()=>({...n.query}));Ct(()=>n.query,u=>{u!=null&&u.catalog&&n.path==="/tables"&&_()});const t={fileCount:"File Count",totalSize:"Total Size",averageFileSize:"Average File Size",lastCommitTime:"Last Commit Time"},s={...t,baseWatermark:"Base Watermark"},p={...t,tableWatermark:"Table Watermark"},e=Y({detailLoading:!1,baseDetailInfo:{optimizingStatus:"",tableType:"",tableName:"",createTime:"",tableFormat:"",hasPartition:!1},pkList:[],partitionColumnList:[],properties:[],changeMetrics:[],baseMetrics:[],schema:[]});async function _(){try{const{catalog:N,db:R,table:Q}=r.value;if(!N||!R||!Q)return;e.detailLoading=!0;const G=await Wt({...r.value}),{pkList:Z=[],tableType:X,partitionColumnList:S=[],properties:w,changeMetrics:x,schema:k,createTime:a,tableIdentifier:b,baseMetrics:j,tableSummary:V}=G;e.baseDetailInfo={...V,tableType:X,tableName:`${(b==null?void 0:b.catalog)||""}.${(b==null?void 0:b.database)||""}.${(b==null?void 0:b.tableName)||""}`,createTime:a?at(a):"",hasPartition:!!(S!=null&&S.length)},e.pkList=Z||[],e.partitionColumnList=S||[],e.schema=k||[],e.changeMetrics=Object.keys(p||{}).map(F=>({metric:p[F],value:F==="lastCommitTime"||F==="tableWatermark"?(x||{})[F]?at((x||{})[F]):"":(x||{})[F]})).filter(F=>F.value),e.baseMetrics=Object.keys(s||{}).map(F=>({metric:s[F],value:F==="lastCommitTime"||F==="baseWatermark"?(j||{})[F]?at((j||{})[F]):"":(j||{})[F]})),e.properties=Object.keys(w||{}).map(F=>({key:F,value:w[F]})),u()}catch{}finally{e.detailLoading=!1}function u(){T("setBaseDetailInfo",e.baseDetailInfo)}}lt(()=>{_()}),y({getTableDetails:_});const m=et([{title:l("field"),dataIndex:"field",width:"30%"},{title:l("type"),dataIndex:"type",width:"20%"},{title:l("required"),dataIndex:"required",width:"20%",customRender:u=>String(u==null?void 0:u.value)},{title:l("description"),dataIndex:"comment",ellipsis:!0}]),z=et([{title:l("field"),dataIndex:"field",width:"30%"},{title:l("sourceField"),dataIndex:"sourceField",width:"30%"},{title:l("transform"),dataIndex:"transform",ellipsis:!0}]),E=et([{title:l("metric"),dataIndex:"metric",width:"50%",ellipsis:!0},{title:l("value"),dataIndex:"value",ellipsis:!0}]),A=et([{title:l("key"),dataIndex:"key",width:"50%",ellipsis:!0},{title:l("value"),dataIndex:"value",ellipsis:!0}]);return(u,N)=>{const R=ht,Q=bt("u-loading");return c(),L("div",Na,[d("div",Ma,[e.pkList&&e.pkList.length?(c(),L("div",Pa,[d("p",Fa,f(u.$t("primaryKey")),1),v(R,{"row-key":"field",columns:H(m),"data-source":e.pkList,pagination:!1},null,8,["columns","data-source"])])):U("",!0),e.partitionColumnList&&e.partitionColumnList.length?(c(),L("div",Ra,[d("p",Ba,f(u.$t("partitionKey")),1),v(R,{"row-key":"field",columns:H(z),"data-source":e.partitionColumnList,pagination:!1},null,8,["columns","data-source"])])):U("",!0),d("div",Ua,[d("p",Ka,f(u.$t("schema")),1),v(R,{"row-key":"field",columns:H(m),"data-source":e.schema,pagination:!1},null,8,["columns","data-source"])])]),d("div",ja,[e.changeMetrics&&e.changeMetrics.length?(c(),L("div",qa,[d("p",Ga,f(u.$t("changeTableMetrics")),1),v(R,{columns:H(E),"data-source":e.changeMetrics,pagination:!1},null,8,["columns","data-source"])])):U("",!0),d("div",Ha,[d("p",Va,f(u.$t("baseTableMetrics")),1),v(R,{columns:H(E),"data-source":e.baseMetrics,pagination:!1},null,8,["columns","data-source"])]),d("div",Wa,[d("p",Ya,f(u.$t("properties")),1),v(R,{columns:H(A),"data-source":e.properties,pagination:!1},null,8,["columns","data-source"])])]),e.detailLoading?(c(),q(Q,{key:0})):U("",!0)])}}}),Ja=ft(Za,[["__scopeId","data-v-1756822f"]]),Qa={class:"table-partitons"},Xa={class:"filter-wrap"},tn=it({__name:"Files",props:{hasPartition:{type:Boolean}},setup(C){const y=C,g=B(!1),{t:T}=mt(),l=et([{title:T("partition"),dataIndex:"partition",ellipsis:!0},{title:T("fileCount"),dataIndex:"fileCount",width:120,ellipsis:!0},{title:T("size"),dataIndex:"size",width:120,ellipsis:!0},{title:T("lastCommitTime"),dataIndex:"lastCommitTime",width:200,ellipsis:!0}]),n=et([{title:T("file"),dataIndex:"file",ellipsis:!0},{title:T("fileType"),dataIndex:"fileType",width:120,ellipsis:!0},{title:T("size"),dataIndex:"size",width:120,ellipsis:!0},{title:T("commitTime"),dataIndex:"commitTime",width:200,ellipsis:!0},{title:T("commitId"),dataIndex:"commitId",width:200,ellipsis:!0},{title:T("path"),dataIndex:"path",ellipsis:!0,scopedSlots:{customRender:"path"}}]),r=Y([]),t=Y([]),s=B(""),p=B(0),e=B(!1),_=Y(ut()),m=Y(ut()),E=pt().query,A=Y({catalog:"",db:"",table:"",...E}),u=B("");async function N(S){u.value=S,await R()}async function R(){try{e.value=!0,r.length=0;const S=await Yt({...A,filter:u.value,page:_.current,pageSize:_.pageSize}),{list:w,total:x}=S;_.total=x,(w||[]).forEach(k=>{k.lastCommitTime=k.lastCommitTime?at(k.lastCommitTime):"",r.push(k)})}catch{}finally{e.value=!1}}function Q({current:S=1,pageSize:w=25}){!g.value&&y.hasPartition?(_.current=S,w!==_.pageSize&&(_.current=1),_.pageSize=w):(m.current=S,w!==m.pageSize&&(m.current=1),m.pageSize=w),G()}function G(){if(!y.hasPartition){Z();return}g.value?Z():R()}async function Z(){try{t.length=0,e.value=!0;const S={...A,partition:y.hasPartition?encodeURIComponent(s.value):null,specId:p.value,page:m.current,pageSize:m.pageSize},w=await Zt(S),{list:x,total:k}=w;m.total=k,(x||[]).forEach(a=>{a.commitTime=a.commitTime?at(a.commitTime):"",t.push(a)})}catch{}finally{e.value=!1}}function X(S){s.value=S.partition,p.value=S.specId,g.value=!g.value,g.value&&(m.current=1,Z())}return lt(()=>{g.value=!1,y.hasPartition?R():Z()}),(S,w)=>{const x=ue,k=de,a=ce,b=vt,j=ht,V=wt,F=$t,tt=xt;return c(),L("div",Qa,[!g.value&&S.hasPartition?(c(),L(J,{key:0},[d("div",Xa,[v(a,{value:u.value,"onUpdate:value":w[1]||(w[1]=I=>u.value=I),placeholder:S.$t("fileSearchPlaceholder"),style:{width:"350px"},onSearch:w[2]||(w[2]=I=>N(I))},Ut({prefix:i(()=>[v(x)]),_:2},[u.value?{name:"suffix",fn:i(()=>[v(k,{class:"input-clear-icon",onClick:w[0]||(w[0]=I=>N(""))})]),key:"0"}:void 0]),1032,["value","placeholder"])]),v(j,{"row-key":"partiton",columns:H(l),"data-source":r,pagination:_,loading:e.value,onChange:Q},{bodyCell:i(({column:I,record:M})=>[I.dataIndex==="partition"?(c(),q(b,{key:0,type:"link",onClick:W=>X(M)},{default:i(()=>[K(f(M.partition),1)]),_:2},1032,["onClick"])):U("",!0)]),_:1},8,["columns","data-source","pagination","loading"])],64)):(c(),L(J,{key:1},[S.hasPartition?(c(),q(F,{key:0,separator:">"},{default:i(()=>[v(V,{class:"text-active",onClick:X},{default:i(()=>[K(" All ")]),_:1}),v(V,null,{default:i(()=>[K(f(`${S.$t("partition")} ${s.value}`),1)]),_:1})]),_:1})):U("",!0),v(j,{"row-key":"file",columns:H(n),"data-source":t,pagination:m,loading:e.value,onChange:Q},{bodyCell:i(({column:I,record:M})=>[I.dataIndex==="file"?(c(),q(tt,{key:0},{title:i(()=>[K(f(M.file),1)]),default:i(()=>[d("span",null,f(M.file),1)]),_:2},1024)):U("",!0),I.dataIndex==="path"?(c(),q(tt,{key:1},{title:i(()=>[K(f(M.path),1)]),default:i(()=>[d("span",null,f(M.path),1)]),_:2},1024)):U("",!0)]),_:1},8,["columns","data-source","pagination","loading"])],64))])}}}),en=ft(tn,[["__scopeId","data-v-257203c0"]]);var Bt={exports:{}};/*!
 * clipboard.js v2.0.11
 * https://clipboardjs.com/
 *
 * Licensed MIT Â© Zeno Rocha
 */(function(C,y){(function(T,l){C.exports=l()})(Ie,function(){return function(){var g={686:function(n,r,t){t.d(r,{default:function(){return It}});var s=t(279),p=t.n(s),e=t(370),_=t.n(e),m=t(817),z=t.n(m);function E(O){try{return document.execCommand(O)}catch{return!1}}var A=function(o){var h=z()(o);return E("cut"),h},u=A;function N(O){var o=document.documentElement.getAttribute("dir")==="rtl",h=document.createElement("textarea");h.style.fontSize="12pt",h.style.border="0",h.style.padding="0",h.style.margin="0",h.style.position="absolute",h.style[o?"right":"left"]="-9999px";var $=window.pageYOffset||document.documentElement.scrollTop;return h.style.top="".concat($,"px"),h.setAttribute("readonly",""),h.value=O,h}var R=function(o,h){var $=N(o);h.container.appendChild($);var D=z()($);return E("copy"),$.remove(),D},Q=function(o){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body},$="";return typeof o=="string"?$=R(o,h):o instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(o==null?void 0:o.type)?$=R(o.value,h):($=z()(o),E("copy")),$},G=Q;function Z(O){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Z=function(h){return typeof h}:Z=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},Z(O)}var X=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=o.action,$=h===void 0?"copy":h,D=o.container,P=o.target,ot=o.text;if($!=="copy"&&$!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"');if(P!==void 0)if(P&&Z(P)==="object"&&P.nodeType===1){if($==="copy"&&P.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if($==="cut"&&(P.hasAttribute("readonly")||P.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`)}else throw new Error('Invalid "target" value, use a valid Element');if(ot)return G(ot,{container:D});if(P)return $==="cut"?u(P):G(P,{container:D})},S=X;function w(O){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?w=function(h){return typeof h}:w=function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},w(O)}function x(O,o){if(!(O instanceof o))throw new TypeError("Cannot call a class as a function")}function k(O,o){for(var h=0;h<o.length;h++){var $=o[h];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(O,$.key,$)}}function a(O,o,h){return o&&k(O.prototype,o),h&&k(O,h),O}function b(O,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");O.prototype=Object.create(o&&o.prototype,{constructor:{value:O,writable:!0,configurable:!0}}),o&&j(O,o)}function j(O,o){return j=Object.setPrototypeOf||function($,D){return $.__proto__=D,$},j(O,o)}function V(O){var o=I();return function(){var $=M(O),D;if(o){var P=M(this).constructor;D=Reflect.construct($,arguments,P)}else D=$.apply(this,arguments);return F(this,D)}}function F(O,o){return o&&(w(o)==="object"||typeof o=="function")?o:tt(O)}function tt(O){if(O===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function M(O){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},M(O)}function W(O,o){var h="data-clipboard-".concat(O);if(o.hasAttribute(h))return o.getAttribute(h)}var rt=function(O){b(h,O);var o=V(h);function h($,D){var P;return x(this,h),P=o.call(this),P.resolveOptions(D),P.listenClick($),P}return a(h,[{key:"resolveOptions",value:function(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof D.action=="function"?D.action:this.defaultAction,this.target=typeof D.target=="function"?D.target:this.defaultTarget,this.text=typeof D.text=="function"?D.text:this.defaultText,this.container=w(D.container)==="object"?D.container:document.body}},{key:"listenClick",value:function(D){var P=this;this.listener=_()(D,"click",function(ot){return P.onClick(ot)})}},{key:"onClick",value:function(D){var P=D.delegateTarget||D.currentTarget,ot=this.action(P)||"copy",_t=S({action:ot,container:this.container,target:this.target(P),text:this.text(P)});this.emit(_t?"success":"error",{action:ot,text:_t,trigger:P,clearSelection:function(){P&&P.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(D){return W("action",D)}},{key:"defaultTarget",value:function(D){var P=W("target",D);if(P)return document.querySelector(P)}},{key:"defaultText",value:function(D){return W("text",D)}},{key:"destroy",value:function(){this.listener.destroy()}}],[{key:"copy",value:function(D){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body};return G(D,P)}},{key:"cut",value:function(D){return u(D)}},{key:"isSupported",value:function(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],P=typeof D=="string"?[D]:D,ot=!!document.queryCommandSupported;return P.forEach(function(_t){ot=ot&&!!document.queryCommandSupported(_t)}),ot}}]),h}(p()),It=rt},828:function(n){var r=9;if(typeof Element<"u"&&!Element.prototype.matches){var t=Element.prototype;t.matches=t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector}function s(p,e){for(;p&&p.nodeType!==r;){if(typeof p.matches=="function"&&p.matches(e))return p;p=p.parentNode}}n.exports=s},438:function(n,r,t){var s=t(828);function p(m,z,E,A,u){var N=_.apply(this,arguments);return m.addEventListener(E,N,u),{destroy:function(){m.removeEventListener(E,N,u)}}}function e(m,z,E,A,u){return typeof m.addEventListener=="function"?p.apply(null,arguments):typeof E=="function"?p.bind(null,document).apply(null,arguments):(typeof m=="string"&&(m=document.querySelectorAll(m)),Array.prototype.map.call(m,function(N){return p(N,z,E,A,u)}))}function _(m,z,E,A){return function(u){u.delegateTarget=s(u.target,z),u.delegateTarget&&A.call(m,u)}}n.exports=e},879:function(n,r){r.node=function(t){return t!==void 0&&t instanceof HTMLElement&&t.nodeType===1},r.nodeList=function(t){var s=Object.prototype.toString.call(t);return t!==void 0&&(s==="[object NodeList]"||s==="[object HTMLCollection]")&&"length"in t&&(t.length===0||r.node(t[0]))},r.string=function(t){return typeof t=="string"||t instanceof String},r.fn=function(t){var s=Object.prototype.toString.call(t);return s==="[object Function]"}},370:function(n,r,t){var s=t(879),p=t(438);function e(E,A,u){if(!E&&!A&&!u)throw new Error("Missing required arguments");if(!s.string(A))throw new TypeError("Second argument must be a String");if(!s.fn(u))throw new TypeError("Third argument must be a Function");if(s.node(E))return _(E,A,u);if(s.nodeList(E))return m(E,A,u);if(s.string(E))return z(E,A,u);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function _(E,A,u){return E.addEventListener(A,u),{destroy:function(){E.removeEventListener(A,u)}}}function m(E,A,u){return Array.prototype.forEach.call(E,function(N){N.addEventListener(A,u)}),{destroy:function(){Array.prototype.forEach.call(E,function(N){N.removeEventListener(A,u)})}}}function z(E,A,u){return p(document.body,E,A,u)}n.exports=e},817:function(n){function r(t){var s;if(t.nodeName==="SELECT")t.focus(),s=t.value;else if(t.nodeName==="INPUT"||t.nodeName==="TEXTAREA"){var p=t.hasAttribute("readonly");p||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),p||t.removeAttribute("readonly"),s=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var e=window.getSelection(),_=document.createRange();_.selectNodeContents(t),e.removeAllRanges(),e.addRange(_),s=e.toString()}return s}n.exports=r},279:function(n){function r(){}r.prototype={on:function(t,s,p){var e=this.e||(this.e={});return(e[t]||(e[t]=[])).push({fn:s,ctx:p}),this},once:function(t,s,p){var e=this;function _(){e.off(t,_),s.apply(p,arguments)}return _._=s,this.on(t,_,p)},emit:function(t){var s=[].slice.call(arguments,1),p=((this.e||(this.e={}))[t]||[]).slice(),e=0,_=p.length;for(e;e<_;e++)p[e].fn.apply(p[e].ctx,s);return this},off:function(t,s){var p=this.e||(this.e={}),e=p[t],_=[];if(e&&s)for(var m=0,z=e.length;m<z;m++)e[m].fn!==s&&e[m].fn._!==s&&_.push(e[m]);return _.length?p[t]=_:delete p[t],this}},n.exports=r,n.exports.TinyEmitter=r}},T={};function l(n){if(T[n])return T[n].exports;var r=T[n]={exports:{}};return g[n](r,r.exports,l),r.exports}return function(){l.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return l.d(r,{a:r}),r}}(),function(){l.d=function(n,r){for(var t in r)l.o(r,t)&&!l.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:r[t]})}}(),function(){l.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)}}(),l(686)}().default})})(Bt);var an=Bt.exports;const nn=Te(an),on=C=>({toClipboard(y,g){return new Promise((T,l)=>{const n=document.createElement("button"),r=new nn(n,{text:()=>y,action:()=>"copy",container:g!==void 0?g:document.body});r.on("success",t=>{r.destroy(),T(t)}),r.on("error",t=>{r.destroy(),l(t)}),document.body.appendChild(n),n.click(),document.body.removeChild(n)})}}),sn={class:"table-operations"},ln=["onClick"],rn=it({__name:"Operations",setup(C){const{toClipboard:y}=on(),{t:g}=mt(),T=et([{title:g("time"),dataIndex:"ts",width:"30%"},{title:g("operation"),dataIndex:"operation",scopedSlots:{customRender:"operation"}}]),l=B(!1),n=B(""),r=Y([]),t=B(!1),s=Y(ut()),e=pt().query,_=Y({catalog:"",db:"",table:"",...e});async function m(){try{t.value=!0,r.length=0;const N=await Jt({..._,page:s.current,pageSize:s.pageSize}),{total:R,list:Q}=N;s.total=R,(Q||[]).forEach(G=>{G.ts=G.ts?at(G.ts):"",r.push(G)})}catch{}finally{t.value=!1}}function z({current:N=1,pageSize:R=25}=s){s.current=N,R!==s.pageSize&&(s.current=1),s.pageSize=R,m()}function E(N){l.value=!0,n.value=N.operation}function A(){l.value=!1}async function u(){try{await y(n.value),pe.success(g("copySuccess")),A()}catch{}}return lt(()=>{m()}),(N,R)=>{const Q=ht,G=vt;return c(),L(J,null,[d("div",sn,[v(Q,{"row-key":"partiton",columns:H(T),"data-source":r,pagination:s,loading:t.value,onChange:z},{bodyCell:i(({column:Z,record:X})=>[Z.dataIndex==="operation"?(c(),L("span",{key:0,class:"text-active g-max-line-3",onClick:S=>E(X)},f(X.operation),9,ln)):U("",!0)]),_:1},8,["columns","data-source","pagination","loading"])]),v(H(At),{open:l.value,width:560,title:N.$t("operationDetails"),class:"operation-wrap",onCancel:A},{footer:i(()=>[v(G,{type:"primary",onClick:u},{default:i(()=>[K(f(N.$t("copy")),1)]),_:1})]),default:i(()=>[K(f(n.value)+" ",1)]),_:1},8,["open","title"])],64)}}}),cn={class:"branch-selector"},un={class:"branch-btn-label"},dn={class:"branch-selector-search"},pn=["onClick"],fn={class:"item-icon"},mn={class:"item-label"},hn={key:1,class:"empty-tips"},vn=["onClick"],gn={class:"item-icon"},_n={class:"item-label"},yn={key:1,class:"empty-tips"},bn=["onClick"],Cn={class:"item-icon"},In={class:"item-label"},Tn={key:1,class:"empty-tips"},Sn={class:"g-mr-4"},kn={class:"g-mr-4"},$n={class:"g-ml-24"},wn=it({__name:"Selector",props:{catalog:String,db:String,table:String,disabled:Boolean},emits:["refChange","consumerChange"],setup(C,{emit:y}){const g=C,T=y,l=dt(()=>g.disabled),n=B({value:"",type:nt.BRANCH,label:""}),r=B(""),t=B(""),s=B(""),p=B(nt.BRANCH),e=B([]),_=B([]),m=B([]),z=dt(()=>e.value.filter(a=>!r.value||a.label.includes(r.value))),E=dt(()=>_.value.filter(a=>!t.value||a.label.includes(t.value))),A=dt(()=>m.value.filter(a=>!s.value||a.label.includes(s.value))),u=B(ct.ALL),N=Y([ct.ALL,ct.OPTIMIZING,ct.NONOPTIMIZING]);function R(a){a.stopPropagation()}function Q(a){return a.parentNode||document.body}function G(a){n.value=a,u.value=ct.ALL,T("refChange",{ref:a.value,operation:ct.ALL})}function Z(a){if(a.value===n.value.value)return;n.value=a;const b={...a.amoroCurrentSnapshotsOfTable};T("consumerChange",{ref:a.value,amoroCurrentSnapshotsItem:b,operation:ct.ALL})}function X(a){T("refChange",{ref:n.value.value,operation:a})}async function S(){const a=await Qt(g);e.value=(a.list||[]).map(b=>({value:b.name,label:b.name,type:nt.BRANCH})),e.value.length&&G(e.value[0])}async function w(){const a=await Xt(g);_.value=(a.list||[]).map(b=>({value:b.name,label:b.name,type:nt.TAG}))}async function x(){const a=await te(g);m.value=(a.list||[]).map(b=>({value:b.consumerId,label:b.consumerId,type:nt.CONSUMER,amoroCurrentSnapshotsOfTable:b.amoroCurrentSnapshotsOfTable}))}async function k(){await Promise.all([S(),w(),x()])}return lt(()=>{p.value=nt.BRANCH,k()}),(a,b)=>{const j=ie,V=he,F=vt,tt=ve,I=ge,M=Nt,W=Mt,rt=fe,It=_e,O=me;return c(),L("div",cn,[v(rt,{trigger:["click"],placement:"bottomLeft","get-popup-container":Q},{overlay:i(()=>[d("div",null,[d("div",dn,[Tt(v(tt,{value:r.value,"onUpdate:value":b[0]||(b[0]=o=>r.value=o),placeholder:a.$t("filterBranchesOrTagsOrConsumers"),onClick:R},null,8,["value","placeholder"]),[[St,p.value===H(nt).BRANCH]]),Tt(v(tt,{value:t.value,"onUpdate:value":b[1]||(b[1]=o=>t.value=o),placeholder:a.$t("filterBranchesOrTagsOrConsumers"),onClick:R},null,8,["value","placeholder"]),[[St,p.value===H(nt).TAG]]),Tt(v(tt,{value:s.value,"onUpdate:value":b[2]||(b[2]=o=>s.value=o),placeholder:a.$t("filterBranchesOrTagsOrConsumers"),onClick:R},null,8,["value","placeholder"]),[[St,p.value===H(nt).CONSUMER]])]),v(W,{activeKey:p.value,"onUpdate:activeKey":b[3]||(b[3]=o=>p.value=o),type:"card"},{default:i(()=>[(c(),q(M,{key:H(nt).BRANCH,tab:a.$t("branches")},{default:i(()=>[z.value.length?(c(!0),L(J,{key:0},st(z.value,(o,h)=>(c(),L("div",{key:h,class:"branch-selector-item",onClick:$=>G(o)},[d("div",fn,[o.value===n.value.value?(c(),q(I,{key:0})):U("",!0)]),d("span",mn,f(o.label),1)],8,pn))),128)):(c(),L("span",hn,f(a.$t("nothingToShow")),1))]),_:1},8,["tab"])),(c(),q(M,{key:H(nt).TAG,tab:a.$t("tags")},{default:i(()=>[E.value.length?(c(!0),L(J,{key:0},st(E.value,(o,h)=>(c(),L("div",{key:h,class:"branch-selector-item",onClick:$=>G(o)},[d("div",gn,[o.value===n.value.value?(c(),q(I,{key:0})):U("",!0)]),d("span",_n,f(o.label),1)],8,vn))),128)):(c(),L("span",yn,f(a.$t("nothingToShow")),1))]),_:1},8,["tab"])),m.value.length!==0?(c(),q(M,{key:H(nt).CONSUMER,tab:a.$t("consumers")},{default:i(()=>[A.value.length?(c(!0),L(J,{key:0},st(A.value,(o,h)=>(c(),L("div",{key:h,class:"branch-selector-item",onClick:$=>Z(o)},[d("div",Cn,[o.value===n.value.value?(c(),q(I,{key:0})):U("",!0)]),d("span",In,f(o.label),1)],8,bn))),128)):(c(),L("span",Tn,f(a.$t("nothingToShow")),1))]),_:1},8,["tab"])):U("",!0)]),_:1},8,["activeKey"])])]),default:i(()=>[v(F,{class:"branch-btn",disabled:!n.value.value||l.value},{default:i(()=>[v(j,{"class-name":"branch-selector-icon","icon-class":n.value.type,class:"g-mr-8"},null,8,["icon-class"]),d("span",un,f(n.value.label),1),v(V)]),_:1},8,["disabled"])]),_:1}),d("div",null,[v(j,{"class-name":"branch-selector-icon","icon-class":"branch",class:"g-mr-4 g-ml-16"}),d("span",Sn,f(e.value.length),1),d("span",null,f(a.$t("branches")),1)]),d("div",null,[v(j,{"class-name":"branch-selector-icon","icon-class":"tag",class:"g-mr-4 g-ml-16"}),d("span",kn,f(_.value.length),1),d("span",null,f(a.$t("tags")),1)]),d("div",$n,[K(f(a.$t("operation"))+": ",1),v(O,{value:u.value,"onUpdate:value":b[4]||(b[4]=o=>u.value=o),class:"g-ml-8",style:{width:"160px"},disabled:l.value||p.value===H(nt).CONSUMER,onChange:X},{default:i(()=>[(c(!0),L(J,null,st(N,o=>(c(),q(It,{key:o,value:o},{default:i(()=>[K(f(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])])])}}}),xn=Object.freeze(Object.defineProperty({__proto__:null,Axis:Se,ChartView:ke,ComponentModel:$e,ComponentView:we,List:xe,Model:Ee,PRIORITY:Oe,SeriesModel:De,color:Le,connect:ze,dataTool:Ae,dependencies:Ne,disConnect:Me,disconnect:Pe,dispose:Fe,env:Re,extendChartView:Be,extendComponentModel:Ue,extendComponentView:Ke,extendSeriesModel:je,format:qe,getCoordinateSystemDimensions:Ge,getInstanceByDom:He,getInstanceById:Ve,getMap:We,graphic:Ye,helper:Ze,init:Je,innerDrawElementOnCanvas:Qe,matrix:Xe,number:ta,parseGeoJSON:Ot,parseGeoJson:Ot,registerAction:ea,registerCoordinateSystem:aa,registerLayout:na,registerLoading:oa,registerLocale:sa,registerMap:ia,registerPostInit:la,registerPostUpdate:ra,registerPreprocessor:ca,registerProcessor:ua,registerTheme:da,registerTransform:pa,registerUpdateLifecycle:fa,registerVisual:ma,setCanvasCreator:ha,setPlatformAPI:va,throttle:ga,time:_a,use:Rt,util:ya,vector:ba,version:Ca,zrUtil:Ia,zrender:Ta},Symbol.toStringTag,{value:"Module"}));Rt([Sa,ka,$a,wa,xa,Ea,Oa,Da,La,za,Aa]);const En=it({props:{width:{type:String,default:"auto"},height:{type:String,default:"350px"},loading:{type:Boolean,default:!1},options:{type:Object,default:()=>{}}},setup(C){let y=null;const{options:g}=zt(C),T=B(),l=()=>{y=xn.init(T.value),y.setOption({...g.value})},n=()=>{y.setOption({...g.value}),y.resize()},r=()=>{y&&y.resize()};return Ct(()=>g.value,t=>{t&&n()},{deep:!0}),Kt(()=>{window.removeEventListener("resize",r)}),lt(()=>{window.addEventListener("resize",r),l()}),{echart:T}}});function On(C,y,g,T,l,n){const r=ye;return c(),q(r,{spinning:C.loading,class:"echarts-loading"},{default:i(()=>[d("div",{ref:"echart",style:kt({width:C.width,height:C.height}),class:"timeline-echarts"},null,4)]),_:1},8,["spinning"])}const Dt=ft(En,[["render",On]]);function Dn(C={},y=(g,T)=>Number(g)-Number(T)){const g=Object.keys(C);if(!g.length)return{};const T={};return g.sort(y).forEach(l=>T[l]=C[l]),T}function Lt(C,y){if(!y)return{};y=Dn(y);const g=Object.keys(y),T={tooltip:{trigger:"axis"},yAxis:{type:"value"},xAxis:{type:"category",data:g.map(n=>at(n)),axisTick:{alignWithLabel:!0,interval:0}},grid:{top:40,bottom:50,left:"1%",containLabel:!0}};C&&(T.title={left:"center",text:C});const l={};return Object.values(y).forEach(n=>{Object.keys(n).forEach(t=>{const s=le.global.t(t);l[s]||(l[s]=[]),l[s].push(n[t])})}),T.legend={top:"bottom",data:Object.keys(l),lineStyle:{opacity:0}},T.series=Object.keys(l).map(n=>({name:n,type:"line",symbol:"circle",data:l[n]})),T}const Ln={class:"table-snapshots"},zn=it({__name:"Snapshots",setup(C){const y=B(!1),{t:g}=mt(),T=et([{title:g("snapshotId"),dataIndex:"snapshotId",ellipsis:!0},{title:g("operation"),dataIndex:"operation"},{title:g("records"),dataIndex:"records"},{title:g("fileCount"),dataIndex:"fileCount"},{title:g("commitTime"),dataIndex:"commitTime"}]),l=et([{title:g("operation"),dataIndex:"operation",width:120,ellipsis:!0},{title:g("file"),dataIndex:"file",ellipsis:!0},{title:g("partition"),dataIndex:"partition",width:120},{title:g("fileType"),dataIndex:"fileType",width:120,ellipsis:!0},{title:g("size"),dataIndex:"size",width:120},{title:g("commitTime"),dataIndex:"commitTime",width:200,ellipsis:!0},{title:g("path"),dataIndex:"path",ellipsis:!0}]),n=Y([]),r=Y([]),t=B(""),s=B(!1),p=Y(ut()),e=Y(ut()),m=pt().query,z=Y({catalog:"",db:"",table:"",...m}),E=B({}),A=B({}),u=B(""),N=B("");function R(x){u.value=x.ref,N.value=x.operation,G()}function Q(x){u.value=x.ref,N.value=x.operation,n.length=0,x.amoroCurrentSnapshotsItem.commitTime=x.amoroCurrentSnapshotsItem.commitTime?at(x.amoroCurrentSnapshotsItem.commitTime):"-",n.push(x.amoroCurrentSnapshotsItem),p.total=1}async function G(){try{s.value=!0,n.length=0;const x=await ee({...z,ref:u.value,operation:N.value,page:p.current,pageSize:p.pageSize}),{list:k=[],total:a}=x,b={},j={};k.forEach(V=>{const{recordsSummaryForChart:F,filesSummaryForChart:tt,commitTime:I}=V;b[I]=F||{},j[I]=tt||{},V.producer==="OPTIMIZE"&&(V.operation=`${V.operation}(optimizing)`),V.commitTime=V.commitTime?at(V.commitTime):"-",n.push(V)}),E.value=Lt(g("recordChartTitle"),b),A.value=Lt(g("fileChartTitle"),j),p.total=a}catch{}finally{s.value=!1}}function Z({current:x=1,pageSize:k=25}){y.value?(e.current=x,k!==e.pageSize&&(e.current=1),e.pageSize=k):(p.current=x,k!==p.pageSize&&(p.current=1),p.pageSize=k),X()}function X(){y.value?S():G()}async function S(){try{r.length=0,s.value=!0;const x={...z,snapshotId:t.value,page:e.current,pageSize:e.pageSize},k=await ae(x),{list:a,total:b}=k;e.total=b,a.forEach(j=>{j.commitTime=j.commitTime?at(j.commitTime):"",r.push(j)})}catch{}finally{s.value=!1}}function w(x){t.value=x.snapshotId,y.value=!y.value,y.value&&(e.current=1,S())}return lt(()=>{y.value=!1}),(x,k)=>{const a=Ft,b=Pt,j=vt,V=ht,F=wt,tt=$t,I=xt;return c(),L("div",Ln,[y.value?(c(),L(J,{key:1},[v(tt,{separator:">"},{default:i(()=>[v(F,{class:"text-active",onClick:w},{default:i(()=>[K(" All ")]),_:1}),v(F,null,{default:i(()=>[K(f(`${x.$t("snapshotId")} ${t.value}`),1)]),_:1})]),_:1}),v(V,{"row-key":"file",columns:H(l),"data-source":r,pagination:e,loading:s.value,class:"g-mt-8",onChange:Z},{bodyCell:i(({column:M,record:W})=>[M.dataIndex==="path"?(c(),q(I,{key:0},{title:i(()=>[K(f(W.path),1)]),default:i(()=>[d("span",null,f(W.path),1)]),_:2},1024)):U("",!0),M.dataIndex==="file"?(c(),q(I,{key:1},{title:i(()=>[K(f(W.file),1)]),default:i(()=>[d("span",null,f(W.file),1)]),_:2},1024)):U("",!0)]),_:1},8,["columns","data-source","pagination","loading"])],64)):(c(),L(J,{key:0},[v(b,null,{default:i(()=>[v(a,{span:12},{default:i(()=>[v(Dt,{loading:s.value,options:E.value},null,8,["loading","options"])]),_:1}),v(a,{span:12},{default:i(()=>[v(Dt,{loading:s.value,options:A.value},null,8,["loading","options"])]),_:1})]),_:1}),v(wn,{catalog:z.catalog,db:z.db,table:z.table,disabled:s.value,onConsumerChange:Q,onRefChange:R},null,8,["catalog","db","table","disabled"]),v(V,{"row-key":"snapshotId",columns:H(T),"data-source":n,pagination:p,loading:s.value,onChange:Z},{bodyCell:i(({column:M,record:W})=>[M.dataIndex==="snapshotId"?(c(),q(j,{key:0,type:"link",onClick:rt=>w(W)},{default:i(()=>[K(f(W.snapshotId),1)]),_:2},1032,["onClick"])):U("",!0)]),expandedRowRender:i(({record:M})=>[(c(!0),L(J,null,st(M.summary,(W,rt)=>(c(),q(b,{key:rt,type:"flex",gutter:16},{default:i(()=>[v(a,{flex:"220px",style:{"text-align":"right"}},{default:i(()=>[K(f(rt)+" : ",1)]),_:2},1024),v(a,{flex:"auto"},{default:i(()=>[K(f(W),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["columns","data-source","pagination","loading"])],64))])}}}),An=ft(zn,[["__scopeId","data-v-ce26555c"]]),gt=C=>(jt("data-v-40bb06a9"),C=C(),qt(),C),Nn={class:"table-optimizing"},Mn={class:""},Pn=gt(()=>d("div",{class:""}," success / total ",-1)),Fn={class:""},Rn=gt(()=>d("div",{class:""}," size / count ",-1)),Bn={class:""},Un=gt(()=>d("div",{class:""}," size / count ",-1)),Kn={key:1,class:"g-flex-ac"},jn={class:"tip-title"},qn={class:""},Gn=gt(()=>d("div",{class:""}," size / count ",-1)),Hn={class:""},Vn=gt(()=>d("div",{class:""}," size / count ",-1)),Wn={key:1,class:"g-flex-ac"},Yn={class:"tip-title"},Zn=it({__name:"Optimizing",setup(C){const y=B(!1),g=et({RUNNING:{title:"RUNNING",color:"#1890ff"},CLOSED:{title:"CLOSED",color:"#c9cdd4"},SUCCESS:{title:"SUCCESS",color:"#0ad787"},FAILED:{title:"FAILED",color:"#f5222d"}}),T=et({PLANNED:{title:"PLANNED",color:"#ffcc00"},SCHEDULED:{title:"SCHEDULED",color:"#4169E1"},ACKED:{title:"ACKED",color:"#1890ff"},FAILED:{title:"FAILED",color:"#f5222d"},SUCCESS:{title:"SUCCESS",color:"#0ad787"},CANCELED:{title:"CANCELED",color:"#c9cdd4"}}),{t:l}=mt(),n=et([{title:l("processId"),dataIndex:"processId"},{title:l("startTime"),dataIndex:"startTime",width:172},{title:l("type"),dataIndex:"optimizingType"},{title:l("status"),dataIndex:"status"},{title:l("duration"),dataIndex:"duration",width:120},{title:l("tasks"),dataIndex:"tasks"},{title:l("finishTime"),dataIndex:"finishTime",width:172},{title:l("input"),dataIndex:"inputFiles"},{title:l("output"),dataIndex:"outputFiles"}]),r=et([{title:l("taskId"),dataIndex:"taskId",width:82},{title:l("partition"),dataIndex:"partitionData",ellipsis:!0},{title:l("startTime"),dataIndex:"startTime",width:172},{title:l("status"),dataIndex:"status",width:124},{title:l("costTime"),dataIndex:"formatCostTime",width:120},{title:l("finishTime"),dataIndex:"endTime",width:172},{title:l("input"),dataIndex:"inputFilesDesc"},{title:l("output"),dataIndex:"outputFilesDesc"}]),t=Y([]),s=B(0),p=Y([]),e=B(!1),_=B(!0),m=Y(ut()),z=Y(ut()),A=pt().query,u=Y({catalog:"",db:"",table:"",...A});async function N(){try{e.value=!0,t.length=0;const S=await oe({...u,page:m.current,pageSize:m.pageSize}),{list:w,total:x=0}=S;m.total=x,t.push(...[...w||[]].map(k=>{const{inputFiles:a={},outputFiles:b={}}=k;return{...k,startTime:k.startTime?at(k.startTime):"-",finishTime:k.finishTime?at(k.finishTime):"-",optimizingType:k.optimizingType?k.optimizingType:"-",duration:k.duration?Et(k.duration):"-",inputFiles:`${yt(a.totalSize)} / ${a.fileCnt}`,outputFiles:`${yt(b.totalSize)} / ${b.fileCnt}`,tasks:`${k.successTasks||"0"} / ${k.totalTasks||"0"}${k.runningTasks?` (${k.runningTasks} running)`:""}`}}))}catch{}finally{e.value=!1}}async function R(){At.confirm({title:l("cancelOptimizingProcessOptModalTitle"),onOk:async()=>{var S;try{e.value=!0,await se({...u,processId:(S=s.value)==null?void 0:S.toString()}),_.value=!0,G()}catch{}finally{e.value=!1}}})}function Q({current:S=1,pageSize:w=25}){y.value?(z.current=S,w!==z.pageSize&&(z.current=1),z.pageSize=w):(m.current=S,w!==m.pageSize&&(m.current=1),m.pageSize=w),G()}function G(){y.value?Z():N()}async function Z(){try{p.length=0,e.value=!0;const S={...u,processId:s.value,page:z.current,pageSize:z.pageSize},w=await ne(S),{list:x,total:k}=w;z.total=k,x.forEach(a=>{a.startTime=a.startTime?at(a.startTime):"-",a.endTime=a.endTime?at(a.endTime):"-",a.formatCostTime=a.costTime?Et(a.costTime):"-",a.thread=a.optimizerToken?`(${a.threadId})${a.optimizerToken}`:"-",a.partitionData=a.partitionData?a.partitionData:"-",a.inputFilesDesc=`${yt(a.inputFiles.totalSize)} / ${a.inputFiles.fileCnt}`,a.outputFilesDesc=`${yt(a.outputFiles.totalSize)} / ${a.outputFiles.fileCnt}`,p.push(a)})}catch{}finally{e.value=!1}}function X(S,w){s.value=S,_.value=w!=="RUNNING",y.value=!y.value,y.value&&(z.current=1),G()}return lt(()=>{y.value=!1,G()}),(S,w)=>{const x=vt,k=be,a=xt,b=Ft,j=Pt,V=ht,F=wt,tt=$t;return c(),L("div",Nn,[y.value?(c(),L(J,{key:1},[v(j,null,{default:i(()=>[v(b,{span:18},{default:i(()=>[v(tt,{separator:">"},{default:i(()=>[v(F,{class:"text-active",onClick:X},{default:i(()=>[K(" All ")]),_:1}),v(F,null,{default:i(()=>[K(f(`${S.$t("processId")} ${s.value}`),1)]),_:1})]),_:1})]),_:1}),v(b,{span:6},{default:i(()=>[v(x,{disabled:_.value,"onUpdate:disabled":w[0]||(w[0]=I=>_.value=I),type:"primary",class:"g-mb-16",style:{float:"right"},onClick:R},{default:i(()=>[K(f(H(l)("cancelProcess")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),v(V,{"row-key":"taskId",columns:H(r),"data-source":p,pagination:z,loading:e.value,class:"g-mt-8",onChange:Q},{headerCell:i(({column:I})=>[I.dataIndex==="inputFilesDesc"?(c(),L(J,{key:0},[d("div",qn,f(I.title),1),Gn],64)):U("",!0),I.dataIndex==="outputFilesDesc"?(c(),L(J,{key:1},[d("div",Hn,f(I.title),1),Vn],64)):U("",!0)]),bodyCell:i(({column:I,record:M})=>[I.dataIndex==="partitionData"?(c(),q(a,{key:0},{title:i(()=>[K(f(M.partitionData),1)]),default:i(()=>[d("span",null,f(M.partitionData),1)]),_:2},1024)):U("",!0),I.dataIndex==="status"?(c(),L("div",Wn,[d("span",{style:kt({"background-color":(H(T)[M.status]||{}).color}),class:"status-icon"},null,4),d("span",null,f(M.status),1),M.status==="FAILED"?(c(),q(a,{key:0,placement:"topRight",class:"g-ml-4","overlay-class-name":"table-failed-tip"},{title:i(()=>[d("div",Yn,f(M.failReason),1)]),default:i(()=>[v(k)]),_:2},1024)):U("",!0)])):U("",!0)]),expandedRowRender:i(({record:I})=>[(c(!0),L(J,null,st(I.summary,(M,W)=>(c(),q(j,{key:W,type:"flex",gutter:16},{default:i(()=>[v(b,{flex:"220px",style:{"text-align":"right"}},{default:i(()=>[K(f(W)+" : ",1)]),_:2},1024),v(b,{flex:"auto"},{default:i(()=>[K(f(M),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["columns","data-source","pagination","loading"])],64)):(c(),q(V,{key:0,"row-key":"processId",columns:H(n),"data-source":t,pagination:m,loading:e.value,onChange:Q},{headerCell:i(({column:I})=>[I.dataIndex==="tasks"?(c(),L(J,{key:0},[d("div",Mn,f(I.title),1),Pn],64)):U("",!0),I.dataIndex==="inputFiles"?(c(),L(J,{key:1},[d("div",Fn,f(I.title),1),Rn],64)):U("",!0),I.dataIndex==="outputFiles"?(c(),L(J,{key:2},[d("div",Bn,f(I.title),1),Un],64)):U("",!0)]),bodyCell:i(({record:I,column:M})=>[M.dataIndex==="processId"?(c(),q(x,{key:0,type:"link",onClick:W=>X(I.processId,I.status)},{default:i(()=>[K(f(I.processId),1)]),_:2},1032,["onClick"])):U("",!0),M.dataIndex==="status"?(c(),L("div",Kn,[d("span",{style:kt({"background-color":(H(g)[I.status]||{}).color}),class:"status-icon"},null,4),d("span",null,f(I.status),1),I.status==="FAILED"?(c(),q(a,{key:0,placement:"topRight",class:"g-ml-4","overlay-class-name":"table-failed-tip"},{title:i(()=>[d("div",jn,f(I.failReason),1)]),default:i(()=>[v(k)]),_:2},1024)):U("",!0)])):U("",!0)]),expandedRowRender:i(({record:I})=>[(c(!0),L(J,null,st(I.summary,(M,W)=>(c(),q(j,{key:W,type:"flex",gutter:16},{default:i(()=>[v(b,{flex:"220px",style:{"text-align":"right"}},{default:i(()=>[K(f(W)+" : ",1)]),_:2},1024),v(b,{flex:"auto"},{default:i(()=>[K(f(M),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["columns","data-source","pagination","loading"]))])}}}),Jn=ft(Zn,[["__scopeId","data-v-40bb06a9"]]),Qn=it({name:"Tables",components:{UDetails:Ja,UFiles:en,UOperations:rn,USnapshots:An,UOptimizing:Jn},setup(){const C=Gt(),y=pt(),g=re(),T=B(),l=et([{key:"Snapshots",label:"snapshots"},{key:"Optimizing",label:"optimizing"},{key:"Operations",label:"operations"}]),n=Y({activeKey:"Details",isSecondaryNav:!1,baseInfo:{optimizingStatus:"",tableType:"",tableName:"",createTime:"",tableFormat:"",hasPartition:!1},detailLoaded:!1}),r=dt(()=>n.baseInfo.tableType==="ICEBERG"),t=_=>{n.detailLoaded=!0,n.baseInfo={..._}},s=_=>{const m={...y.query};m.tab=_.toString(),C.replace({query:{...m}})},p=()=>{g.updateTablesMenu(!1)},e=()=>{n.isSecondaryNav=!1,C.back()};return Ct(()=>y.path,()=>{n.isSecondaryNav=!!y.path.includes("create")},{immediate:!0}),Ct(()=>y.query,(_,m)=>{const{catalog:z,db:E,table:A}=_,{catalog:u,db:N,table:R}=m;if(`${z}${E}${A}`!=`${u}${N}${R}`){n.activeKey="Details";return}n.activeKey=_.tab}),lt(()=>{var _;n.activeKey=((_=y.query)==null?void 0:_.tab)||"Details",Ht(()=>{T.value&&T.value.getTableDetails()})}),{...zt(n),detailRef:T,tabConfigs:l,store:g,isIceberg:r,setBaseDetailInfo:t,hideTablesMenu:p,goBack:e,onChangeTab:s}}}),Xn={class:"tables-wrap"},to={key:0,class:"tables-content"},eo={class:"g-flex-jsb"},ao={class:"g-flex-col"},no={class:"g-flex"},oo=["title"],so={class:"table-info g-flex-ac"},io={class:"text-color"},lo={class:"text-color"},ro={class:"text-color"},co={class:"text-color"},uo={class:"content"};function po(C,y,g,T,l,n){const r=Ce,t=bt("UDetails"),s=Nt,p=bt("UFiles"),e=Mt,_=bt("router-view");return c(),L("div",Xn,[C.isSecondaryNav?(c(),q(_,{key:1,onGoBack:C.goBack},null,8,["onGoBack"])):(c(),L("div",to,[d("div",eo,[d("div",ao,[d("div",no,[d("span",{title:C.baseInfo.tableName,class:"table-name g-text-nowrap"},f(C.baseInfo.tableName),9,oo)]),d("div",so,[d("p",null,[K(f(C.$t("optimizingStatus"))+": ",1),d("span",io,f(C.baseInfo.optimizingStatus),1)]),v(r,{type:"vertical"}),d("p",null,[K(f(C.$t("records"))+": ",1),d("span",lo,f(C.baseInfo.records),1)]),v(r,{type:"vertical"}),C.isIceberg?U("",!0):(c(),L(J,{key:0},[d("p",null,[K(f(C.$t("createTime"))+": ",1),d("span",ro,f(C.baseInfo.createTime),1)]),v(r,{type:"vertical"})],64)),d("p",null,[K(f(C.$t("tableFormat"))+": ",1),d("span",co,f(C.baseInfo.tableFormat),1)])])])]),d("div",uo,[v(e,{activeKey:C.activeKey,"onUpdate:activeKey":y[0]||(y[0]=m=>C.activeKey=m),"destroy-inactive-tab-pane":"",onChange:C.onChangeTab},{default:i(()=>[v(s,{key:"Details",tab:C.$t("details"),"force-render":""},{default:i(()=>[v(t,{ref:"detailRef",onSetBaseDetailInfo:C.setBaseDetailInfo},null,8,["onSetBaseDetailInfo"])]),_:1},8,["tab"]),C.detailLoaded?(c(),q(s,{key:"Files",tab:C.$t("files")},{default:i(()=>[v(p,{"has-partition":C.baseInfo.hasPartition},null,8,["has-partition"])]),_:1},8,["tab"])):U("",!0),(c(!0),L(J,null,st(C.tabConfigs,m=>(c(),q(s,{key:m.key,tab:C.$t(m.label)},{default:i(()=>[(c(),q(Vt(`U${m.key}`)))]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey","onChange"])])]))])}const $o=ft(Qn,[["render",po],["__scopeId","data-v-88a9cfee"]]);export{$o as default};
