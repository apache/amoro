
/*
  * Licensed to the Apache Software Foundation (ASF) under one
  * or more contributor license agreements.  See the NOTICE file
  * distributed with this work for additional information
  * regarding copyright ownership.  The ASF licenses this file
  * to you under the Apache License, Version 2.0 (the
  * "License"); you may not use this file except in compliance
  * with the License.  You may obtain a copy of the License at
  *
  *     http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */

import{d as U,U as L,ae as q,X as r,a0 as C,a3 as i,a6 as v,k as _,u as D,a2 as f,f as R,V as B,Y as I,a7 as V,a8 as G,c as K,r as j,w as H,j as F,o as W,I as X,W as S,G as Y}from"./vue-KZ6HWXOH.js";import{p as z,M as A,B as J,v as O,u as P}from"./antd-CPSoav-4.js";import{_ as E}from"./index-C3lMfZSI.js";import{u as g}from"./common.type-BplHNJCB.js";import{p as Q,q as Z}from"./table.service-CoshcICY.js";import"./dayjs-DZyl58SH.js";import"./pinia-BCc-Ghqu.js";import"./monaco-DM8nFf3H.js";import"./sql-BwF-LpWF.js";import"./axios-B4uVmeYG.js";const x={class:"hive-table-detail g-flex"},tt={class:"left-content"},et={key:0,class:"table-attrs"},at={class:"attr-title"},st={class:"table-attrs"},ot={class:"attr-title"},nt=U({__name:"Details",props:{schema:{},partitionColumnList:{}},setup(t){const a=t,{t:s}=L(),o=q([{title:s("field"),dataIndex:"field",width:"30%"},{title:s("type"),dataIndex:"type",width:"30%"},{title:s("description"),dataIndex:"comment",ellipsis:!0}]),l=q([{title:s("field"),dataIndex:"field",width:"30%"},{title:s("type"),dataIndex:"type",width:"30%"},{title:s("description"),dataIndex:"comment",ellipsis:!0}]);return(c,e)=>{const n=z;return r(),C("div",x,[i("div",tt,[a.partitionColumnList&&a.partitionColumnList.length?(r(),C("div",et,[i("p",at,v(c.$t("partitionKey")),1),_(n,{"row-key":"field",columns:D(l),"data-source":a.partitionColumnList,pagination:!1},null,8,["columns","data-source"])])):f("",!0),i("div",st,[i("p",ot,v(c.$t("schema")),1),_(n,{"row-key":"field",columns:D(o),"data-source":a.schema,pagination:!1},null,8,["columns","data-source"])])])])}}}),rt=E(nt,[["__scopeId","data-v-36931cfd"]]),it={class:"msg"},lt=U({__name:"ErrorMsg",props:{msg:{}},emits:["cancel"],setup(t,{emit:a}){const s=t,o=a,l=R(!0);return(c,e)=>(r(),B(D(A),{open:l.value,"onUpdate:open":e[0]||(e[0]=n=>l.value=n),width:560,title:c.$t("errorMessage"),footer:null,class:"upgrade-error",onCancel:e[1]||(e[1]=n=>o("cancel"))},{default:I(()=>[i("p",it,v(s.msg),1)]),_:1},8,["open","title"]))}}),ut=E(lt,[["__scopeId","data-v-ef59d3ca"]]),ct=U({name:"Tables",components:{UDetails:rt,ErrorMsg:ut},setup(){const t=g,a=R(),s=V(),o=G(),{t:l}=L(),c=K(()=>!!o.path.includes("upgrade")),e=j({loading:!1,showErrorMsg:!1,activeKey:"Details",status:"",displayStatus:"",errorMessage:"",tableName:"tableName",partitionColumnList:[],schema:[]}),n=()=>{s.back()},m=K(()=>({...o.query})),M=async(d=!1)=>{try{a.value&&clearTimeout(a.value);const{catalog:p,db:b,table:w}=m.value;if(!p||!b||!w)return;!d&&(e.loading=!0);const k=await Q({...m.value}),{status:u,errorMessage:$}=k;e.status=u,e.displayStatus=u===g.upgrading?l("upgrading"):l("upgrade"),e.errorMessage=$||"",u===g.upgrading?a.value=setTimeout(()=>{M(!0)},1500):u===g.none?N():u===g.success?s.replace({path:"/tables",query:{...o.query}}):u===g.failed&&N()}finally{!d&&(e.loading=!1)}};async function N(){try{const{catalog:d,db:p,table:b}=m.value;if(!d||!p||!b)return;e.loading=!0;const w=await Z({...m.value}),{partitionColumnList:k=[],schema:u,tableIdentifier:$}=w;e.tableName=($==null?void 0:$.tableName)||"",e.partitionColumnList=k||[],e.schema=u||[]}catch{}finally{e.loading=!1}}async function y(){await M()}function T(){s.push({path:"/hive-tables/upgrade",query:{...o.query}})}function h(){y()}return H(()=>o.query,(d,p)=>{const{catalog:b,db:w,table:k}=d;o.path==="/hive-tables"&&(b!==p.catalog||w!==p.db||k!==p.table)&&y()}),F(()=>{clearTimeout(a.value)}),W(()=>{y()}),{...X(e),isSecondaryNav:c,upgradeStatus:t,upgradeTable:T,goBack:n,refresh:h}}}),dt={class:"hive-tables-wrap"},pt={key:0,class:"tables-content"},mt={class:"g-flex-jsb table-top"},gt=["title"],ft={class:"right-btn"},_t={class:"content"};function vt(t,a,s,o,l,c){const e=J,n=S("UDetails"),m=P,M=O,N=S("u-loading"),y=S("router-view"),T=S("ErrorMsg");return r(),C("div",dt,[t.isSecondaryNav?f("",!0):(r(),C("div",pt,[i("div",mt,[i("span",{title:t.tableName,class:"table-name g-text-nowrap"},v(t.tableName),9,gt),i("div",ft,[_(e,{type:"primary",disabled:t.status===t.upgradeStatus.upgrading,onClick:t.upgradeTable},{default:I(()=>[Y(v(t.displayStatus),1)]),_:1},8,["disabled","onClick"]),t.status===t.upgradeStatus.failed?(r(),C("p",{key:0,class:"fail-msg",onClick:a[0]||(a[0]=h=>t.showErrorMsg=!0)},v(t.$t("lastUpgradingFailed")),1)):f("",!0)])]),i("div",_t,[_(M,{activeKey:t.activeKey,"onUpdate:activeKey":a[1]||(a[1]=h=>t.activeKey=h)},{default:I(()=>[_(m,{key:"Details",tab:"Details"},{default:I(()=>[_(n,{"partition-column-list":t.partitionColumnList,schema:t.schema},null,8,["partition-column-list","schema"])]),_:1})]),_:1},8,["activeKey"])])])),t.loading?(r(),B(N,{key:1})):f("",!0),t.isSecondaryNav?(r(),B(y,{key:2,onGoBack:t.goBack,onRefresh:t.refresh},null,8,["onGoBack","onRefresh"])):f("",!0),t.showErrorMsg?(r(),B(T,{key:3,msg:t.errorMessage,onCancel:a[2]||(a[2]=h=>t.showErrorMsg=!1)},null,8,["msg"])):f("",!0)])}const Bt=E(ct,[["render",vt],["__scopeId","data-v-924108fc"]]);export{Bt as default};
