
/*
  * Licensed to the Apache Software Foundation (ASF) under one
  * or more contributor license agreements.  See the NOTICE file
  * distributed with this work for additional information
  * regarding copyright ownership.  The ASF licenses this file
  * to you under the Apache License, Version 2.0 (the
  * "License"); you may not use this file except in compliance
  * with the License.  You may obtain a copy of the License at
  *
  *     http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */

import{d as ye,r as N,U as Ce,a7 as _e,a8 as be,f as $,c as B,w as qe,o as ke,W as xe,X as l,a0 as f,a3 as T,k as v,Y as u,a2 as _,V as g,a6 as d,F as J,aa as Q,G,a1 as le,ad as ze,u as me}from"./vue-KZ6HWXOH.js";import{g as Xe,_ as he}from"./optimize.service-CzrEuJsb.js";import{g as je,c as Ve,s as We,d as Ye,a as Je}from"./setting.services-Ded0qQhU.js";import{u as Qe}from"./usePlaceholder-DDdrf-Dx.js";import{M as Z,a as F,B as Ee,F as Ze,c as ea,I as aa,b as ta,m as oa,n as la,o as sa,A as ve}from"./antd-CPSoav-4.js";import{_ as Ie}from"./index-C3lMfZSI.js";import{g as na}from"./table.service-CoshcICY.js";import"./dayjs-DZyl58SH.js";import"./pinia-BCc-Ghqu.js";import"./monaco-DM8nFf3H.js";import"./sql-BwF-LpWF.js";import"./axios-B4uVmeYG.js";const ra={class:"detail-wrap"},ia={class:"detail-content-wrap"},ua={class:"content-wrap"},ca={class:"header"},pa={key:1,class:"config-value"},da={key:1},ga={key:1},fa={key:1},ma={class:"header"},ha={key:1,class:"config-value"},va={key:1,class:"config-value"},ya={key:1,class:"config-value"},Ca={key:3},_a=["onClick"],ba={class:"header"},ka={key:1,class:"config-value"},Ea={key:1,class:"config-value"},Ia={key:1,class:"config-value"},wa={key:6},Na=["title","onClick"],Ta={key:1,class:"config-value"},Sa={key:1,class:"config-value"},Ma={class:"header"},$a={class:"header"},Ra={key:0,class:"footer-btn"},Pa={key:1,class:"footer-btn"},La=ye({__name:"Detail",props:{isEdit:{type:Boolean}},emits:["updateEdit","updateCatalogs"],setup(se,{emit:D}){const ee=se,H=D,h={"Internal Catalog":"Internal Catalog","External Catalog":"External Catalog"},e=N({catalog:{name:"",type:"ams",typeshow:h["Internal Catalog"],optimizerGroup:void 0},tableFormatList:[],storageConfig:{},authConfig:{},properties:{},tableProperties:{},storageConfigArray:[],authConfigArray:[]}),{t:p}=Ce(),R=_e(),K=be(),P=N(Qe()),j=$(""),c=B(()=>ee.isEdit),S=B(()=>"/ams/v1/files"),E=B(()=>{var t;const a=(((t=K.query)==null?void 0:t.catalogname)||"").toString();return decodeURIComponent(a)==="new catalog"}),q=B(()=>e.catalog.type==="hive"),L=$(!1),A=$(),O=$(),m=$(),r={MIXED_HIVE:"MIXED_HIVE",ICEBERG:"ICEBERG",MIXED_ICEBERG:"MIXED_ICEBERG",PAIMON:"PAIMON",HUDI:"HUDI"},C={[r.ICEBERG]:"Iceberg",[r.MIXED_HIVE]:"Mixed Hive",[r.MIXED_ICEBERG]:"Mixed Iceberg",[r.PAIMON]:"Paimon",[r.HUDI]:"Hudi"},I={ams:[r.MIXED_ICEBERG,r.ICEBERG],hive:[r.MIXED_HIVE,r.MIXED_ICEBERG,r.ICEBERG,r.PAIMON,r.HUDI],hadoop:[r.MIXED_ICEBERG,r.ICEBERG,r.PAIMON],glue:[r.MIXED_ICEBERG,r.ICEBERG],custom:[r.MIXED_ICEBERG,r.ICEBERG]},U={"hadoop.core.site":"core-site.xml","hadoop.hdfs.site":"hdfs-site.xml","hive.site":"hive-site.xml"},x={storageConfig:{"hadoop.core.site":"","hadoop.hdfs.site":""},authConfig:{"auth.kerberos.keytab":"","auth.kerberos.krb5":""}},V=$([{label:h["Internal Catalog"],value:h["Internal Catalog"]},{label:h["External Catalog"],value:h["External Catalog"]}]),z=N([{label:"SIMPLE",value:"SIMPLE"},{label:"KERBEROS",value:"KERBEROS"}]),we=N([{label:"AK/SK",value:"AK/SK"},{label:"CUSTOM",value:"CUSTOM"}]),ne={"hadoop.core.site":"Hadoop core-site","hadoop.hdfs.site":"Hadoop hdfs-site","hive.site":"Hadoop hive-site"},Ne={"auth.kerberos.keytab":"Kerberos Keytab","auth.kerberos.krb5":"Kerberos Krb5"},ae={ams:["warehouse"],hadoop:["warehouse"],custom:["catalog-impl"],glue:["warehouse","lock-impl","lock.table"],PAIMON:["warehouse"]};qe(()=>K.query,a=>{a&&Te()},{immediate:!0,deep:!0});const W=N([]),re=$([]);function Te(){te()}async function Se(){const t=(await Xe()||[]).map(s=>({lable:s.resourceGroup.name,value:s.resourceGroup.name}));t.length===0?Z.confirm({title:p("noResourceGroupsTitle"),content:p("noResourceGroupsContent"),okText:p("goToButtonText"),onOk:async()=>{try{R.push({path:"/optimizing",query:{tab:"optimizergroup"}})}catch(s){console.error("Navigation error:",s)}}}):re.value=t}async function Me(){(await je()||[]).forEach(t=>{t.value!=="ams"&&W.push({label:t.display,value:t.value})}),ie()}function ie(){j.value=(W.find(a=>a.value===e.catalog.type)||{}).label||""}async function te(){try{L.value=!0;const{catalogname:a,type:t}=K.query;if(!a)return;if(E.value){e.catalog.name="",e.catalog.type=t||"ams",e.catalog.optimizerGroup=void 0,e.tableFormatList=[r.MIXED_ICEBERG],e.authConfig={...x.authConfig},e.storageConfig={...x.storageConfig};const n=ae[e.catalog.type]||[];e.properties={},n.forEach(y=>{e.properties[y]=""}),e.tableProperties={},e.storageConfigArray.length=0,e.authConfigArray.length=0}else{const n=await Je(a);if(!n)return;const{name:y,type:b,tableFormatList:k,storageConfig:M,authConfig:X,properties:oe,tableProperties:o,optimizerGroup:w}=n;e.catalog.name=y,e.catalog.type=b,e.catalog.optimizerGroup=w,e.tableFormatList=[...k],e.authConfig=X,e.storageConfig=M,e.properties=oe||{},e.tableProperties=o||{},e.storageConfigArray.length=0,e.authConfigArray.length=0,ie()}e.catalog.typeshow=e.catalog.type==="ams"?h["Internal Catalog"]:h["External Catalog"];const{storageConfig:s,authConfig:i}=e;Object.keys(s).forEach(n=>{var b,k,M;const y=["hadoop.core.site","hadoop.hdfs.site"];if(q.value&&y.push("hive.site"),y.includes(n)){const X={key:n,label:ne[n],value:(b=s[n])==null?void 0:b.fileName,fileName:(k=s[n])==null?void 0:k.fileName,fileUrl:(M=s[n])==null?void 0:M.fileUrl,fileId:"",fileList:[],uploadLoading:!1,isSuccess:!1};e.storageConfigArray.push(X)}}),Object.keys(i).forEach(n=>{var y,b,k;if(["auth.kerberos.keytab","auth.kerberos.krb5"].includes(n)){const M={key:n,label:Ne[n],value:(y=i[n])==null?void 0:y.fileName,fileName:(b=i[n])==null?void 0:b.fileName,fileUrl:(k=i[n])==null?void 0:k.fileUrl,fileId:"",fileList:[],uploadLoading:!1,isSuccess:!1};e.authConfigArray.push(M)}})}catch{}finally{L.value=!1}}function $e(a){a===h["Internal Catalog"]?e.catalog.type="ams":e.catalog.type=W[0].value,de()}const ue=B(()=>{const a=e.catalog.type;return I[a]||[]});async function ce(){const a=await O.value.getPropertiesWithoputValidation(),t=ae[e.catalog.type]||[];t.forEach(i=>{i&&!a[i]&&(a[i]="")});const s=e.tableFormatList.reduce((i,n)=>[...i,...ae[n]||[]],[]);s.forEach(i=>{i&&!a[i]&&(a[i]="")});for(const i in a)!a[i]&&!t.includes(i)&&!s.includes(i)&&delete a[i];e.properties=a}const Re=N([{label:"S3",value:"S3"}]),Pe=N([{label:"Hadoop",value:"Hadoop"}]),pe=N([{label:"Hadoop",value:"Hadoop"},{label:"S3",value:"S3"}]),Le=B(()=>{const a=e.catalog.type;return a==="ams"||a==="custom"?pe:a==="glue"?Re:a==="hive"?Pe:a==="hadoop"?pe:null}),Ue=B(()=>{const a=e.storageConfig["storage.type"];return a==="Hadoop"?z:a==="S3"?we:null});async function de(){if(e.tableFormatList=[ue.value[0]],!E.value)return;const a=e.storageConfigArray.findIndex(t=>t.key==="hive.site");if(q.value){if(a>-1)return;e.storageConfigArray.push({key:"hive.site",label:ne["hive.site"],value:"",fileName:"",fileUrl:"",fileId:"",fileList:[],uploadLoading:!1,isSuccess:!1}),e.storageConfig["hive.site"]=""}else a>-1&&(e.storageConfigArray.splice(a,1),delete e.storageConfig["hive.site"]);await ce()}async function Ge(){await ce()}function Ae(){H("updateEdit",!0)}async function Oe(){if(await Ve(e.catalog.name)){Ke();return}Z.confirm({title:p("cannotDeleteModalTitle"),content:p("cannotDeleteModalContent"),wrapClassName:"not-delete-modal"})}async function Be(a,t){return t?/^[a-z][\w-]*$/i.test(t)?Promise.resolve():Promise.reject(new Error(p("invalidInput"))):Promise.reject(new Error(p("inputPlaceholder")))}function Fe(){const{storageConfig:a,authConfig:t,storageConfigArray:s,authConfigArray:i}=e;Object.keys(t).forEach(n=>{if(["auth.kerberos.keytab","auth.kerberos.krb5"].includes(n)){const y=(i.find(b=>b.key===n)||{}).fileId;t[n]=y||""}}),Object.keys(a).forEach(n=>{if(["hadoop.core.site","hadoop.hdfs.site","hive.site"].includes(n)){const y=(s.find(b=>b.key===n)||{}).fileId;a[n]=y||""}})}function De(){A.value.validateFields().then(async()=>{const{catalog:a,tableFormatList:t,storageConfig:s,authConfig:i}=e,n=await O.value.getProperties(),y=await m.value.getProperties();if(!n||!y)return;L.value=!0;const{typeshow:b,...k}=a;Fe(),await We({isCreate:E.value,...k,tableFormatList:t,storageConfig:s,authConfig:i,properties:n,tableProperties:y}).then(()=>{F.success(`${p("save")} ${p("success")}`),H("updateEdit",!1,{catalogName:a.name||"",catalogType:a.type||""}),te(),A.value.resetFields()}).catch(()=>{F.error(`${p("save")} ${p("failed")}`)}).finally(()=>{L.value=!1})}).catch(()=>{})}function He(){A.value.resetFields(),H("updateEdit",!1),te()}async function Ke(){Z.confirm({title:p("deleteCatalogModalTitle"),onOk:async()=>{try{await Ye(e.catalog.name||""),F.success(`${p("remove")} ${p("success")}`,1,()=>{R.replace({path:"/catalogs",query:{}}).then(()=>R.go(0))})}catch{F.error(`${p("remove")} ${p("failed")}`)}}})}function ge(a,t,s){try{if(a.file.status==="uploading"?t.uploadLoading=!0:t.uploadLoading=!1,a.file.status==="done"){const{code:i}=a.file.response;if(i!==200){const{message:b}=a.file.response;throw new Error(b)}const{url:n,id:y}=a.file.response.result;t.isSuccess=!0,t.fileName=s==="STORAGE"?U[t.key]:a.file.name,t.fileUrl=n,t.fileId=y,F.success(`${a.file.name} ${p("uploaded")} ${p("success")}`)}else a.file.status==="error"&&(t.isSuccess=!1,F.error(`${a.file.name} ${p("uploaded")} ${p("failed")}`))}catch(i){F.error(i.message)}}function fe(a){a&&window.open(a)}return ke(()=>{Me(),Se()}),(a,t)=>{const s=ea,i=aa,n=ta,y=oa,b=la,k=Ee,M=sa,X=Ze,oe=xe("u-loading");return l(),f("div",ra,[T("div",ia,[T("div",ua,[v(X,{ref_key:"formRef",ref:A,model:e,class:"catalog-form"},{default:u(()=>[v(s,null,{default:u(()=>[T("p",ca,d(a.$t("basic")),1)]),_:1}),v(s,{label:a.$t("name"),name:["catalog","name"],rules:[{required:c.value&&E.value,validator:Be}]},{default:u(()=>[c.value&&E.value?(l(),g(i,{key:0,value:e.catalog.name,"onUpdate:value":t[0]||(t[0]=o=>e.catalog.name=o)},null,8,["value"])):(l(),f("span",pa,d(e.catalog.name),1))]),_:1},8,["label","rules"]),v(s,{label:a.$t("type"),name:["catalog","typeshow"]},{default:u(()=>[c.value&&E.value?(l(),g(n,{key:0,value:e.catalog.typeshow,"onUpdate:value":t[1]||(t[1]=o=>e.catalog.typeshow=o),options:V.value,placeholder:P.selectPh,onChange:$e},null,8,["value","options","placeholder"])):(l(),f("span",da,d(e.catalog.typeshow),1))]),_:1},8,["label"]),e.catalog.typeshow===h["External Catalog"]?(l(),g(s,{key:0,label:a.$t("metastore"),name:["catalog","type"],rules:[{required:c.value&&E.value}]},{default:u(()=>[c.value&&E.value?(l(),g(n,{key:0,value:e.catalog.type,"onUpdate:value":t[2]||(t[2]=o=>e.catalog.type=o),options:W,placeholder:P.selectPh,onChange:de},null,8,["value","options","placeholder"])):(l(),f("span",ga,d(j.value),1))]),_:1},8,["label","rules"])):_("",!0),v(s,{label:a.$t("tableFormat"),name:["tableFormatList"],rules:[{required:c.value&&E.value}]},{default:u(()=>[v(b,{value:e.tableFormatList,"onUpdate:value":t[3]||(t[3]=o=>e.tableFormatList=o),disabled:!c.value||!E.value,onChange:Ge},{default:u(()=>[(l(!0),f(J,null,Q(ue.value,o=>(l(),g(y,{key:o,value:o},{default:u(()=>[G(d(C[o]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1},8,["label","rules"]),v(s,{label:a.$t("optimizerGroup"),name:["catalog","optimizerGroup"],rules:[{required:c.value}]},{default:u(()=>[c.value?(l(),g(n,{key:0,value:e.catalog.optimizerGroup,"onUpdate:value":t[4]||(t[4]=o=>e.catalog.optimizerGroup=o),options:re.value,placeholder:P.selectPh},null,8,["value","options","placeholder"])):(l(),f("span",fa,d(e.catalog.optimizerGroup),1))]),_:1},8,["label","rules"]),v(s,null,{default:u(()=>[T("p",ma,d(a.$t("storageConfigName")),1)]),_:1}),v(s,{label:"Type",name:["storageConfig","storage.type"],rules:[{required:c.value}]},{default:u(()=>[c.value?(l(),g(n,{key:0,value:e.storageConfig["storage.type"],"onUpdate:value":t[5]||(t[5]=o=>e.storageConfig["storage.type"]=o),placeholder:P.selectPh,options:Le.value},null,8,["value","placeholder","options"])):(l(),f("span",ha,d(e.storageConfig["storage.type"]),1))]),_:1},8,["rules"]),e.storageConfig["storage.type"]==="S3"?(l(),g(s,{key:1,label:"Endpoint",name:["storageConfig","storage.s3.endpoint"],rules:[{required:!1}]},{default:u(()=>[c.value?(l(),g(i,{key:0,value:e.storageConfig["storage.s3.endpoint"],"onUpdate:value":t[6]||(t[6]=o=>e.storageConfig["storage.s3.endpoint"]=o)},null,8,["value"])):(l(),f("span",va,d(e.storageConfig["storage.s3.endpoint"]),1))]),_:1})):_("",!0),e.storageConfig["storage.type"]==="S3"?(l(),g(s,{key:2,label:"Region",name:["storageConfig","storage.s3.region"],rules:[{required:!1}]},{default:u(()=>[c.value?(l(),g(i,{key:0,value:e.storageConfig["storage.s3.region"],"onUpdate:value":t[7]||(t[7]=o=>e.storageConfig["storage.s3.region"]=o)},null,8,["value"])):(l(),f("span",ya,d(e.storageConfig["storage.s3.region"]),1))]),_:1})):_("",!0),e.storageConfig["storage.type"]==="Hadoop"?(l(),f("div",Ca,[(l(!0),f(J,null,Q(e.storageConfigArray,o=>(l(),g(s,{key:o.label,label:o.label,class:"g-flex-ac"},{default:u(()=>[c.value?(l(),g(M,{key:0,"file-list":o.fileList,"onUpdate:fileList":w=>o.fileList=w,name:"file",accept:".xml","show-upload-list":!1,action:S.value,disabled:o.uploadLoading,onChange:w=>ge(w,o,"STORAGE")},{default:u(()=>[v(k,{type:"primary",ghost:"",loading:o.uploadLoading,class:"g-mr-12"},{default:u(()=>[G(d(a.$t("upload")),1)]),_:2},1032,["loading"])]),_:2},1032,["file-list","onUpdate:fileList","action","disabled","onChange"])):_("",!0),o.isSuccess||o.fileName?(l(),f("span",{key:1,class:le(["config-value",{"view-active":!!o.fileUrl}]),onClick:w=>fe(o.fileUrl)},d(o.fileName),11,_a)):_("",!0)]),_:2},1032,["label"]))),128))])):_("",!0),v(s,null,{default:u(()=>[T("p",ba,d(a.$t("authenticationConfig")),1)]),_:1}),v(s,{label:"Type",name:["authConfig","auth.type"],rules:[{required:c.value}]},{default:u(()=>[c.value?(l(),g(n,{key:0,value:e.authConfig["auth.type"],"onUpdate:value":t[8]||(t[8]=o=>e.authConfig["auth.type"]=o),placeholder:P.selectPh,options:Ue.value},null,8,["value","placeholder","options"])):(l(),f("span",ka,d(e.authConfig["auth.type"]),1))]),_:1},8,["rules"]),e.authConfig["auth.type"]==="SIMPLE"?(l(),g(s,{key:4,label:"Hadoop Username",name:["authConfig","auth.simple.hadoop_username"],rules:[{required:c.value}]},{default:u(()=>[c.value?(l(),g(i,{key:0,value:e.authConfig["auth.simple.hadoop_username"],"onUpdate:value":t[9]||(t[9]=o=>e.authConfig["auth.simple.hadoop_username"]=o)},null,8,["value"])):(l(),f("span",Ea,d(e.authConfig["auth.simple.hadoop_username"]),1))]),_:1},8,["rules"])):_("",!0),e.authConfig["auth.type"]==="KERBEROS"?(l(),g(s,{key:5,label:"Kerberos Principal",name:["authConfig","auth.kerberos.principal"],rules:[{required:c.value}]},{default:u(()=>[c.value?(l(),g(i,{key:0,value:e.authConfig["auth.kerberos.principal"],"onUpdate:value":t[10]||(t[10]=o=>e.authConfig["auth.kerberos.principal"]=o)},null,8,["value"])):(l(),f("span",Ia,d(e.authConfig["auth.kerberos.principal"]),1))]),_:1},8,["rules"])):_("",!0),e.authConfig["auth.type"]==="KERBEROS"?(l(),f("div",wa,[(l(!0),f(J,null,Q(e.authConfigArray,o=>(l(),g(s,{key:o.label,label:o.label,class:"g-flex-ac"},{default:u(()=>[c.value?(l(),g(M,{key:0,"file-list":o.fileList,"onUpdate:fileList":w=>o.fileList=w,name:"file",accept:o.key==="auth.kerberos.keytab"?".keytab":".conf","show-upload-list":!1,action:S.value,disabled:o.uploadLoading,onChange:w=>ge(w,o)},{default:u(()=>[v(k,{type:"primary",ghost:"",loading:o.uploadLoading,class:"g-mr-12"},{default:u(()=>[G(d(a.$t("upload")),1)]),_:2},1032,["loading"])]),_:2},1032,["file-list","onUpdate:fileList","accept","action","disabled","onChange"])):_("",!0),o.isSuccess||o.fileName?(l(),f("span",{key:1,class:le(["config-value auth-filename",{"view-active":!!o.fileUrl}]),title:o.fileName,onClick:w=>fe(o.fileUrl)},d(o.fileName),11,Na)):_("",!0)]),_:2},1032,["label"]))),128))])):_("",!0),e.authConfig["auth.type"]==="AK/SK"?(l(),g(s,{key:7,label:"Access Key",name:["authConfig","auth.ak_sk.access_key"],rules:[{required:c.value}]},{default:u(()=>[c.value?(l(),g(i,{key:0,value:e.authConfig["auth.ak_sk.access_key"],"onUpdate:value":t[11]||(t[11]=o=>e.authConfig["auth.ak_sk.access_key"]=o)},null,8,["value"])):(l(),f("span",Ta,d(e.authConfig["auth.ak_sk.access_key"]),1))]),_:1},8,["rules"])):_("",!0),e.authConfig["auth.type"]==="AK/SK"?(l(),g(s,{key:8,label:"Secret Key",name:["authConfig","auth.ak_sk.secret_key"],rules:[{required:c.value}]},{default:u(()=>[c.value?(l(),g(i,{key:0,value:e.authConfig["auth.ak_sk.secret_key"],"onUpdate:value":t[12]||(t[12]=o=>e.authConfig["auth.ak_sk.secret_key"]=o)},null,8,["value"])):(l(),f("span",Sa,d(e.authConfig["auth.ak_sk.secret_key"]),1))]),_:1},8,["rules"])):_("",!0),v(s,null,{default:u(()=>[T("p",Ma,d(a.$t("properties")),1)]),_:1}),v(s,null,{default:u(()=>[v(he,{ref_key:"propertiesRef",ref:O,"properties-obj":e.properties,"is-edit":c.value},null,8,["properties-obj","is-edit"])]),_:1}),v(s,null,{default:u(()=>[T("p",$a,d(a.$t("tableProperties")),1)]),_:1}),v(s,null,{default:u(()=>[v(he,{ref_key:"tablePropertiesRef",ref:m,"properties-obj":e.tableProperties,"is-edit":c.value},null,8,["properties-obj","is-edit"])]),_:1})]),_:1},8,["model"])])]),c.value?(l(),f("div",Ra,[v(k,{type:"primary",class:"save-btn g-mr-12",onClick:De},{default:u(()=>[G(d(a.$t("save")),1)]),_:1}),v(k,{onClick:He},{default:u(()=>[G(d(a.$t("cancel")),1)]),_:1})])):_("",!0),c.value?_("",!0):(l(),f("div",Pa,[v(k,{type:"primary",class:"edit-btn g-mr-12",onClick:Ae},{default:u(()=>[G(d(a.$t("edit")),1)]),_:1}),v(k,{class:"remove-btn",onClick:Oe},{default:u(()=>[G(d(a.$t("remove")),1)]),_:1})])),L.value?(l(),g(oe,{key:2})):_("",!0)])}}}),Ua=Ie(La,[["__scopeId","data-v-c8ccd533"]]),Ga={class:"catalogs-wrap g-flex"},Aa={class:"catalog-list-left"},Oa={class:"catalog-header"},Ba={key:0,class:"catalog-list"},Fa=["onClick"],Da={class:"catalog-detail"},Y="new catalog",Ha=ye({__name:"index",setup(se){const{t:D}=Ce(),ee=_e(),H=be(),h=N([]),e=N({catalogName:"",catalogType:""}),p=$(!1),R=$(!1),K=ve.PRESENTED_IMAGE_SIMPLE;async function P(){try{R.value=!0;const m=await na();h.length=0,(m||[]).forEach(r=>{h.push({catalogName:r.catalogName,catalogType:r.catalogType})})}finally{R.value=!1}}function j(){var I,U;const{catalogname:m="",type:r}=H.query,C={catalogName:"",catalogType:""};if(decodeURIComponent(m)===Y){L();return}m?(C.catalogName=m,C.catalogType=r):(C.catalogName=(I=h[0])==null?void 0:I.catalogName,C.catalogType=(U=h[0])==null?void 0:U.catalogType),S(C)}function c(m){p.value?O(()=>{S(m),p.value=!1,E(!1)}):S(m)}async function S(m){const{catalogName:r,catalogType:C}=m;e.catalogName=r||"",e.catalogType=C||"",await ee.replace({path:"/catalogs",query:{catalogname:encodeURIComponent(e.catalogName),type:e.catalogType}})}async function E(m,r){var I,U,x,V;p.value=m,r&&(await q(),r!=null&&r.catalogName||(r.catalogName=(I=h[0])==null?void 0:I.catalogName,r.catalogType=(U=h[0])==null?void 0:U.catalogType));const C=h.findIndex(z=>z.catalogName===Y);if(C>-1){h.splice(C);const z={catalogName:(x=h[0])==null?void 0:x.catalogName,catalogType:(V=h[0])==null?void 0:V.catalogType};S(z);return}r&&S(r)}async function q(){await P()}function L(){p.value?O(()=>{A()}):A()}async function A(){const m={catalogName:Y,catalogType:""};await S(m),h.push(m),p.value=!0}ke(async()=>{await P(),j()});function O(m){Z.confirm({title:D("leavePageModalTitle"),content:D("leavePageModalContent"),okText:D("leave"),onOk:async()=>{m&&await m()}})}return ze((m,r,C)=>{p.value?O(()=>{C()}):C()}),(m,r)=>{const C=Ee;return l(),f("div",Ga,[T("div",Aa,[T("div",Oa,d(`${m.$t("catalog")} ${m.$t("list")}`),1),h.length&&!R.value?(l(),f("ul",Ba,[(l(!0),f(J,null,Q(h,I=>(l(),f("li",{key:I.catalogName,class:le(["catalog-item g-text-nowrap",{active:I.catalogName===e.catalogName}]),onClick:U=>c(I)},d(I.catalogName),11,Fa))),128))])):_("",!0),v(C,{disabled:e.catalogName===Y,class:"add-btn",onClick:L},{default:u(()=>[G(" + ")]),_:1},8,["disabled"])]),T("div",Da,[!h.length&&!R.value?(l(),g(me(ve),{key:0,image:me(K),class:"detail-empty"},null,8,["image"])):(l(),g(Ua,{key:1,"is-edit":p.value,onUpdateEdit:E,onUpdateCatalogs:q},null,8,["is-edit"]))])])}}}),et=Ie(Ha,[["__scopeId","data-v-5e18c611"]]);export{et as default};
